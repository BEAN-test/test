<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TWICE 2026 Guide</title>

<link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
<link rel="icon" type="image/png" href="icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
  :root { --primary: #F04E98; --bg: #fdfbfb; --card-bg: #ffffff; --text: #333; --grad: linear-gradient(135deg, #FFAD60, #F04E98); }
  body { font-family: -apple-system, sans-serif; margin:0; background: var(--bg); color: var(--text); padding-bottom: 120px; }
  header { background: var(--grad); color:white; text-align:center; padding:18px; font-weight:bold; position:sticky; top:0; z-index:1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: 0.3s; }
  
  .member-palette { display: flex; overflow-x: auto; padding: 15px; gap: 12px; background: #fff; border-bottom: 1px solid #eee; }
  .member-dot { width: 32px; height: 32px; border-radius: 50%; border: 2px solid #f0f0f0; flex-shrink: 0; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

  #countdown { background:#222; color:#FFAD60; font-size:1em; padding:8px; text-align:center; font-family: monospace; }
  .tabs { display: flex; background: white; position: sticky; top: 71px; z-index: 999; border-bottom: 1px solid #ddd; }
  .tab-btn { padding: 14px; border: none; background: none; font-weight: bold; color: #bbb; flex: 1; outline:none; }
  .tab-btn.active { color: #F04E98; border-bottom: 3px solid #F04E98; }

  .day-content { display: none; padding: 15px; }
  .day-content.active { display: block; }

  .event-card { 
    background: var(--card-bg); border-radius: 15px; padding: 16px; margin-bottom: 15px; 
    box-shadow: 0 4px 12px rgba(0,0,0,0.05); position: relative; border-left: 10px solid var(--primary); transition: border-color 0.3s;
  }

  .info-box { background: #f9f9f9; padding: 10px; border-radius: 8px; font-size: 0.85em; margin-bottom: 8px; border: 1px solid #eee; color: #444; }
  .subway-info { color: #2c3e50; font-weight: bold; margin-bottom: 5px; border-bottom: 1px dashed #ddd; padding-bottom: 5px; }
  
  .big-add-btn { background: #F04E98; color: white; border: none; width: 100%; padding: 16px; border-radius: 35px; font-weight: bold; margin-top: 10px; font-size: 1em; }
  .route-planner { background: #4285F4; color: white; border: none; width: 100%; padding: 15px; border-radius: 12px; font-weight: bold; margin-bottom: 15px; }

  .color-picker-overlay {
    display: none; position: fixed; bottom: 0; left: 0; right: 0; background: white; 
    padding: 20px 20px 40px; border-radius: 25px 25px 0 0; z-index: 2000; box-shadow: 0 -5px 25px rgba(0,0,0,0.2);
  }
  .picker-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; justify-items: center; }
  .picker-dot { width: 45px; height: 45px; border-radius: 50%; border: 2px solid #f0f0f0; }
  
  [contenteditable="true"]:focus { background: #fff0f5; border-radius: 4px; outline: none; }
</style>
</head>
<body>

<header id="main-header">ğŸ­ TWICE 2026 Tokyo Guide</header>
<div class="member-palette" id="global-palette"></div>
<div id="countdown">00D 00:00:00</div>

<div class="tabs">
  <button class="tab-btn active" onclick="showTab('checklist-tab', this)">ğŸ§³ è£å‚™</button>
  <button class="tab-btn" onclick="showTab('day1', this)">4/25</button>
  <button class="tab-btn" onclick="showTab('day2', this)">4/26</button>
  <button class="tab-btn" onclick="showTab('day3', this)">4/27</button>
</div>

<div id="checklist-tab" class="day-content active">
  <div id="packing-list"></div>
  <button class="big-add-btn" onclick="addCheckItem()">ï¼‹ æ–°å¢å‚™å¿˜ç‰©å“</button>
</div>

<div id="day1" class="day-content"></div>
<div id="day2" class="day-content"></div>
<div id="day3" class="day-content"></div>

<div class="add-area" id="add-btn-container" style="display:none; padding: 0 15px;">
  <button class="route-planner" onclick="generateDailyRoute()">ğŸ—ºï¸ è¦åŠƒä»Šæ—¥ Google Maps è·¯ç·š</button>
  <button class="big-add-btn" onclick="addNewEvent()">ï¼‹ æ–°å¢è¡Œç¨‹åœ°é»</button>
</div>

<div id="color-picker" class="color-picker-overlay">
  <h3 style="margin:0 0 20px; text-align:center;">é¸æ“‡å¡ç‰‡é¡è‰²</h3>
  <div class="picker-grid" id="picker-grid"></div>
  <button onclick="closePicker()" style="width:100%; margin-top:25px; padding:15px; border-radius:15px; border:none; background:#f5f5f5; font-weight:bold;">å–æ¶ˆ</button>
</div>

<script>
  const officialColors = ["#F04E98", "#81D4FA", "#C5E1A5", "#F48FB1", "#B39DDB", "#FFB74D", "#80CBC4", "#F5F5F5", "#EF5350", "#64B5F6"];

  const transportDB = [
    { key: "ç§‹è‘‰åŸ", line: "JR å±±æ‰‹ç·š", station: "ç§‹è‘‰åŸç«™", exit: "é›»æ°£è¡—å£" },
    { key: "åœ‹ç«‹ç«¶æŠ€å ´", line: "éƒ½ç‡Ÿå¤§æ±Ÿæˆ¶ç·š", station: "åœ‹ç«‹ç«¶æŠ€å ´ç«™", exit: "A2å‡ºå£" },
    { key: "æ¾€è°·", line: "JR/éŠ€åº§ç·š/å‰¯éƒ½å¿ƒç·š", station: "æ¾€è°·ç«™", exit: "A6/Hachiko" },
    { key: "æ–°å®¿", line: "JR/ä¸¸ä¹‹å…§ç·š", station: "æ–°å®¿ç«™", exit: "æ±å£/å—å£" },
    { key: "æ± è¢‹", line: "JR/æœ‰æ¨‚ç”ºç·š", station: "æ± è¢‹ç«™", exit: "æ±å£ (35è™Ÿ)" },
    { key: "æ±äº¬ç«™", line: "JR å±±æ‰‹ç·š", station: "æ±äº¬ç«™", exit: "å…«é‡æ´²åŒ—å£" },
    { key: "æ–°å¤§ä¹…ä¿", line: "JR å±±æ‰‹ç·š", station: "æ–°å¤§ä¹…ä¿ç«™", exit: "å”¯ä¸€å‡ºå£" },
    { key: "æˆç”°", line: "Skyliner", station: "æˆç”°æ©Ÿå ´", exit: "ç¬¬ä¸€/äºŒèˆªå»ˆ" }
  ];

  let myItems = JSON.parse(localStorage.getItem('twice_items_v18_9')) || [{text: "è­·ç…§ & é–€ç¥¨", checked: false}];
  
  const initialTripData = {
    day1: [
      {time: "08:00", loc: "æˆç”°æ©Ÿå ´", addr: "æˆç”°æ©Ÿå ´", line: "Skyliner", station: "æˆç”°æ©Ÿå ´", exit: "ç¬¬ä¸€/äºŒèˆªå»ˆ", memo: "æŠµé”æ—¥æœ¬ ğŸ­", color: "#64B5F6"},
      {time: "19:00", loc: "ç§‹è‘‰åŸ", addr: "ç§‹è‘‰åŸ", line: "JR å±±æ‰‹ç·š", station: "ç§‹è‘‰åŸç«™", exit: "é›»æ°£è¡—å£", memo: "é£¯åº— Check-in", color: "#B39DDB"}
    ],
    day2: [
      {time: "09:00", loc: "ç§‹è‘‰åŸ", addr: "ç§‹è‘‰åŸ", line: "JR å±±æ‰‹ç·š", station: "ç§‹è‘‰åŸç«™", exit: "é›»æ°£è¡—å£", memo: "å‡ºç™¼", color: "#B39DDB"},
      {time: "17:00", loc: "åœ‹ç«‹ç«¶æŠ€å ´", addr: "åœ‹ç«‹ç«¶æŠ€å ´", line: "éƒ½ç‡Ÿå¤§æ±Ÿæˆ¶ç·š", station: "åœ‹ç«‹ç«¶æŠ€å ´ç«™", exit: "A2å‡ºå£", memo: "TWICE CONCERT!", color: "#F04E98"},
      {time: "21:30", loc: "ç§‹è‘‰åŸ", addr: "ç§‹è‘‰åŸ", line: "JR å±±æ‰‹ç·š", station: "ç§‹è‘‰åŸç«™", exit: "é›»æ°£è¡—å£", memo: "å›é£¯åº—", color: "#B39DDB"}
    ],
    day3: [
      {time: "09:30", loc: "ç§‹è‘‰åŸ", addr: "ç§‹è‘‰åŸ", line: "JR å±±æ‰‹ç·š", station: "ç§‹è‘‰åŸç«™", exit: "é›»æ°£è¡—å£", memo: "æœ€å¾Œæ¡è²·", color: "#B39DDB"},
      {time: "17:00", loc: "æˆç”°æ©Ÿå ´", addr: "æˆç”°æ©Ÿå ´", line: "Skyliner", station: "æˆç”°æ©Ÿå ´", exit: "ç¬¬ä¸€/äºŒèˆªå»ˆ", memo: "æ­æ©Ÿå›åœ‹ âœˆï¸", color: "#64B5F6"}
    ]
  };

  let myEvents = JSON.parse(localStorage.getItem('twice_trip_v18_9')) || initialTripData;
  let activeTab = 'checklist-tab';
  let editingCard = { day: null, index: null };

  const palette = document.getElementById('global-palette');
  officialColors.forEach((color, idx) => {
    const dot = document.createElement('div');
    dot.className = 'member-dot';
    dot.style.backgroundColor = color;
    dot.onclick = () => {
      // å¦‚æœæ˜¯é»æ“Šç¬¬ä¸€å€‹(TWICEç²‰), è®Šå›æ¼¸å±¤; å¦å‰‡è®Šç´”è‰²
      if(idx === 0) resetTheme();
      else setGlobalTheme(color);
    };
    palette.appendChild(dot);
  });

  function setGlobalTheme(color) {
    document.documentElement.style.setProperty('--primary', color);
    const header = document.getElementById('main-header');
    header.style.background = color; // è®Šæˆç´”è‰²
  }

  function resetTheme() {
    document.documentElement.style.setProperty('--primary', '#F04E98');
    const header = document.getElementById('main-header');
    header.style.background = 'linear-gradient(135deg, #FFAD60, #F04E98)'; // æ¢å¾©é è¨­æ¼¸å±¤
  }

  function autoSuggestTransport(day, index, addressText) {
    const matched = transportDB.find(item => addressText.includes(item.key));
    if (matched) {
      myEvents[day][index].line = matched.line;
      myEvents[day][index].station = matched.station;
      myEvents[day][index].exit = matched.exit;
      renderEvents();
    }
    updateEvent(day, index, 'addr', addressText);
  }

  function renderEvents() {
    ['day1', 'day2', 'day3'].forEach(day => {
      const container = document.getElementById(day); container.innerHTML = "";
      myEvents[day].forEach((ev, index) => {
        container.innerHTML += `
          <div class="event-card" style="border-left-color: ${ev.color}">
            <button style="position:absolute;right:10px;top:45px;border:none;background:none;font-size:1.5em;" onclick="openPicker('${day}', ${index})">ğŸ¨</button>
            <button style="position:absolute;right:10px;top:10px;border:none;background:none;color:#ddd;font-size:1.2em;" onclick="deleteEvent('${day}', ${index})">Ã—</button>
            <span style="font-size:0.9em;font-weight:bold;color:var(--primary)" contenteditable="true" onblur="updateEvent('${day}',${index},'time',this.innerText)">â° ${ev.time}</span>
            <span style="font-size:1.1em;font-weight:bold;display:block;margin:5px 0" contenteditable="true" onblur="updateEvent('${day}',${index},'loc',this.innerText)">ğŸ“ ${ev.loc}</span>
            <div class="info-box">
              <div class="subway-info">ğŸš‡ <span contenteditable="true" onblur="updateEvent('${day}',${index},'line',this.innerText)">${ev.line || 'è·¯ç·š'}</span> / <span contenteditable="true" onblur="updateEvent('${day}',${index},'station',this.innerText)">${ev.station || 'è»Šç«™'}</span> / <span contenteditable="true" onblur="updateEvent('${day}',${index},'exit',this.innerText)">${ev.exit || 'å‡ºå£'}</span></div>
              <div style="font-size:0.9em">ğŸ  <span contenteditable="true" onblur="autoSuggestTransport('${day}',${index},this.innerText)">${ev.addr || 'è¼¸å…¥åœ°å€'}</span></div>
            </div>
            <div style="font-size:0.85em; color:#777" contenteditable="true" onblur="updateEvent('${day}',${index},'memo',this.innerText)">${ev.memo}</div>
          </div>`;
    });
    localStorage.setItem('twice_trip_v18_9', JSON.stringify(myEvents));
    });
  }

  function renderItems() {
    const list = document.getElementById('packing-list'); list.innerHTML = "";
    myItems.forEach((item, i) => {
      list.innerHTML += `<div class="event-card" style="padding:12px; margin-bottom:10px; border-left-width:6px; display:flex; align-items:center;">
        <input type="checkbox" style="width:22px; height:22px; margin-right:12px;" ${item.checked ? 'checked' : ''} onchange="toggleItem(${i})">
        <span style="flex:1" contenteditable="true" onblur="updateItemText(${i}, this.innerText)">${item.text}</span>
        <button style="border:none;background:none;color:#ccc;font-size:1.5em;padding-left:10px;" onclick="deleteItem(${i})">Ã—</button>
      </div>`;
    });
    localStorage.setItem('twice_items_v18_9', JSON.stringify(myItems));
  }

  function deleteItem(index) { if(confirm("åˆªé™¤ç‰©å“ï¼Ÿ")) { myItems.splice(index, 1); renderItems(); } }
  function updateItemText(i, v) { myItems[i].text = v; localStorage.setItem('twice_items_v18_9', JSON.stringify(myItems)); }
  function toggleItem(i) { myItems[i].checked = !myItems[i].checked; localStorage.setItem('twice_items_v18_9', JSON.stringify(myItems)); }
  function addCheckItem() { myItems.push({text: "æ–°ç‰©å“", checked: false}); renderItems(); }
  function updateEvent(d, i, f, v) { myEvents[d][i][f] = v.replace('â° ', '').replace('ğŸ“ ', '').replace('ğŸ  ', '').replace('ğŸš‡ ', ''); localStorage.setItem('twice_trip_v18_9', JSON.stringify(myEvents)); }
  function deleteEvent(d, i) { if(confirm("åˆªé™¤è¡Œç¨‹ï¼Ÿ")) { myEvents[d].splice(i, 1); renderEvents(); } }
  function addNewEvent() { myEvents[activeTab].push({time: "12:00", loc: "æ–°åœ°é»", addr: "", line:"", station:"", exit:"", memo: "é»æ“Šç·¨è¼¯", color: "#F04E98"}); renderEvents(); }
  
  function generateDailyRoute() {
    const addrs = myEvents[activeTab].map(e => e.addr.trim()).filter(a => a !== "" && !a.includes("é»æ“Š"));
    if (addrs.length < 2) return alert("è«‹å¡«å¯«è‡³å°‘å…©å€‹åœ°å€");
    window.location.href = `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(addrs[0])}&destination=${encodeURIComponent(addrs[addrs.length-1])}&waypoints=${encodeURIComponent(addrs.slice(1,-1).join('|'))}&travelmode=transit`;
  }

  function showTab(t, b) { activeTab = t; document.querySelectorAll('.day-content').forEach(d => d.classList.remove('active')); document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active')); document.getElementById(t).classList.add('active'); b.classList.add('active'); document.getElementById('add-btn-container').style.display = (t === 'checklist-tab') ? 'none' : 'block'; }
  function openPicker(d, i) { editingCard = { day: d, index: i }; document.getElementById('picker-grid').innerHTML = officialColors.map(c => `<div class="picker-dot" style="background:${c}" onclick="setCardColor('${c}')"></div>`).join(''); document.getElementById('color-picker').style.display = 'block'; }
  function closePicker() { document.getElementById('color-picker').style.display = 'none'; }
  function setCardColor(c) { myEvents[editingCard.day][editingCard.index].color = c; renderEvents(); closePicker(); }
  
  setInterval(() => {
    const diff = new Date('2026-04-26T17:00:00+09:00') - new Date();
    const d = Math.floor(diff/86400000).toString().padStart(2,'0'), h = Math.floor((diff/3600000)%24).toString().padStart(2,'0'), m = Math.floor((diff/60000)%60).toString().padStart(2,'0'), s = Math.floor((diff/1000)%60).toString().padStart(2,'0');
    document.getElementById('countdown').innerText = diff > 0 ? `${d}D ${h}:${m}:${s}` : 'CONCERT TIME! ğŸ­';
  }, 1000);

  renderItems(); renderEvents();
</script>
</body>
</html>
