<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TWICE 2026 Tokyo</title>

<link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
<link rel="apple-touch-icon" sizes="512x512" href="icon-512.png">
<link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
<link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="TWICE 2026">

<style>
  :root { --primary: #d6336c; --secondary: #ff85a1; --bg: #f8f9fa; --info: #17a2b8; --map: #4285F4; --address-bg: #fff9db; }
  body { font-family: -apple-system, sans-serif; margin:0; background: var(--bg); padding-bottom: 120px; }
  header { background: var(--primary); color:white; text-align:center; padding:15px; font-weight:bold; position:sticky; top:0; z-index:1000; }
  #countdown { background:#333; color:var(--secondary); font-size:1em; padding:8px; text-align:center; font-family: monospace; }
  
  .tabs { display: flex; background: white; border-bottom: 1px solid #ddd; position: sticky; top: 50px; z-index: 999; }
  .tab-btn { padding: 12px; border: none; background: none; font-weight: bold; color: #666; flex: 1; font-size: 0.85em; }
  .tab-btn.active { color: var(--primary); border-bottom: 3px solid var(--primary); background: #fff0f3; }

  .day-content { display: none; padding: 15px; }
  .day-content.active { display: block; }

  /* è£å‚™æ¸…å–®æ¨£å¼ */
  .check-item { display: flex; align-items: center; background: white; padding: 12px; margin-bottom: 8px; border-radius: 10px; border: 1px solid #eee; position: relative; }
  .check-item input { width: 20px; height: 20px; margin-right: 12px; cursor: pointer; }
  .item-text { flex: 1; font-size: 1em; color: #333; }
  .item-del { color: #ccc; border: none; background: none; font-size: 1.2em; padding-left: 10px; }

  /* è¡Œç¨‹å¡ç‰‡ */
  .event-card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 3px 10px rgba(0,0,0,0.08); position: relative; border-left: 6px solid var(--info); }
  .event-card.concert { border-left-color: var(--primary); background: #fff0f3; }
  
  .time-tag { font-size: 0.85em; font-weight: bold; color: var(--primary); display: block; }
  .loc-title { font-size: 1.1em; font-weight: bold; color: #222; margin: 5px 0; display: block; }
  .address-box { background: var(--address-bg); padding: 8px; border-radius: 6px; font-size: 0.8em; margin-bottom: 8px; color: #856404; border: 1px dashed #ffeeba; }
  .memo-content { font-size: 0.82em; color: #555; line-height: 1.5; white-space: pre-wrap; background: #fafafa; padding: 8px; border-radius: 4px; }
  
  /* æŒ‰éˆ•æ¨£å¼ */
  .route-planner { background: var(--map); color: white; border: none; width: 100%; padding: 12px; border-radius: 10px; font-weight: bold; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; gap: 8px; }
  .big-add-btn { background: var(--primary); color: white; border: none; width: 100%; padding: 15px; border-radius: 30px; font-weight: bold; margin-top: 10px; }

  [contenteditable="true"]:focus { background: #fff4f7; outline: 2px solid var(--secondary); border-radius: 4px; padding: 2px; }
</style>
</head>
<body>

<header>ğŸ­ TWICE 2026 è¡Œç¨‹å°èˆª App</header>
<div id="countdown">00D 00:00:00</div>

<div class="tabs">
  <button class="tab-btn active" onclick="showTab('checklist-tab', this)">ğŸ§³ CHECK</button>
  <button class="tab-btn" onclick="showTab('day1', this)">4/25</button>
  <button class="tab-btn" onclick="showTab('day2', this)">4/26</button>
  <button class="tab-btn" onclick="showTab('day3', this)">4/27</button>
</div>

<div id="checklist-tab" class="day-content active">
  <div id="packing-list">
    </div>
  <button class="big-add-btn" onclick="addCheckItem()">ï¼‹ æ–°å¢å‚™å¿˜ç‰©å“</button>
</div>

<div id="day1" class="day-content"></div>
<div id="day2" class="day-content"></div>
<div id="day3" class="day-content"></div>

<div class="add-area" id="add-btn-container" style="display:none;">
  <button class="route-planner" onclick="generateDailyRoute()">ğŸ—ºï¸ é–‹å•Ÿä»Šæ—¥ Google Maps è·¯ç·šå°èˆª</button>
  <button class="big-add-btn" onclick="addNewEvent()">ï¼‹ æ–°å¢è¡Œç¨‹åœ°é»</button>
</div>

<script>
  // CHECK
  const defaultItems = [
    { text: "è­·ç…§ & é–€ç¥¨ QR Code", checked: false },
    { text: "Candybong & å‚™ç”¨é›»æ± ", checked: false },
    { text: "è¡Œå‹•é›»æº (10000mAh+)", checked: false },
    { text: "ä¼‘è¶³æ™‚é–“ & æ­¢ç—›è—¥", checked: false }
  ];

  // åˆå§‹è¡Œç¨‹è³‡æ–™
  const initialData = {
    day1: [
      {time: "10:00", loc: "K-spot (æ±äº¬ä¸€ç•ªè¡—)", addr: "æ±äº¬éƒ½åƒä»£ç”°å€ä¸¸ä¹‹å…§1-9-1", station: "æ±äº¬ç«™", memo: "å®˜æ–¹è¯åå¿«é–ƒ"},
      {time: "13:00", loc: "K-BOOKS K-POPé¤¨", addr: "æ±äº¬éƒ½è±å³¶å€æ±æ± è¢‹1-28-1", station: "æ± è¢‹ç«™", memo: "ç¨€æœ‰å°å¡ç‰†"}
    ],
    day2: [
      {time: "11:00", loc: "Tower Records æ¾€è°·", addr: "æ±äº¬éƒ½æ¾€è°·å€ç¥å—1-22-14", station: "æ¾€è°·ç«™", memo: "æ——è‰¦åº—å¿…é€›"},
      {time: "17:00", loc: "ğŸŸï¸ åœ‹ç«‹ç«¶æŠ€å ´", addr: "æ±äº¬éƒ½æ–°å®¿å€éœä¸˜ç”º10-1", station: "åœ‹ç«‹ç«¶æŠ€å ´ç«™", memo: "CONCERT!", special: "concert"}
    ],
    day3: [
      {time: "10:00", loc: "Seoul Record", addr: "æ±äº¬éƒ½æ–°å®¿å€å¤§ä¹…ä¿1-16-13", station: "æ–°å¤§ä¹…ä¿ç«™", memo: "æ—¥éŸ“å°ˆè¼¯è£œè²¨"}
    ]
  };

  let myItems = JSON.parse(localStorage.getItem('twice_items_v16')) || defaultItems;
  let myEvents = JSON.parse(localStorage.getItem('twice_trip_v16')) || initialData;
  let activeTab = 'checklist-tab';

  function renderAll() {
    renderItems();
    renderEvents();
  }

  // æ¸²æŸ“è£å‚™æ¸…å–®
  function renderItems() {
    const list = document.getElementById('packing-list');
    list.innerHTML = "";
    myItems.forEach((item, index) => {
      list.innerHTML += `
        <div class="check-item">
          <input type="checkbox" ${item.checked ? 'checked' : ''} onchange="toggleItem(${index})">
          <span class="item-text" contenteditable="true" onblur="updateItemText(${index}, this.innerText)">${item.text}</span>
          <button class="item-del" onclick="deleteItem(${index})">Ã—</button>
        </div>
      `;
    });
    localStorage.setItem('twice_items_v16', JSON.stringify(myItems));
  }

  function updateItemText(index, val) { myItems[index].text = val; localStorage.setItem('twice_items_v16', JSON.stringify(myItems)); }
  function toggleItem(index) { myItems[index].checked = !myItems[index].checked; localStorage.setItem('twice_items_v16', JSON.stringify(myItems)); }
  function deleteItem(index) { myItems.splice(index, 1); renderItems(); }
  function addCheckItem() { myItems.push({ text: "é»æ“Šä¿®æ”¹ç‰©å“åç¨±", checked: false }); renderItems(); }

  // æ¸²æŸ“è¡Œç¨‹
  function renderEvents() {
    ['day1', 'day2', 'day3'].forEach(day => {
      const container = document.getElementById(day);
      container.innerHTML = "";
      myEvents[day].forEach((ev, index) => {
        container.innerHTML += `
          <div class="event-card ${ev.special || ''}">
            <button style="position:absolute; right:10px; top:10px; border:none; background:none; color:#ccc;" onclick="deleteEvent('${day}', ${index})">Ã—</button>
            <span class="time-tag" contenteditable="true" onblur="updateEvent('${day}', ${index}, 'time', this.innerText)">â° ${ev.time}</span>
            <span class="loc-title" contenteditable="true" onblur="updateEvent('${day}', ${index}, 'loc', this.innerText)">ğŸ“ ${ev.loc}</span>
            <div class="address-box">ğŸ  åœ°å€: <span contenteditable="true" onblur="updateEvent('${day}', ${index}, 'addr', this.innerText)">${ev.addr || ''}</span></div>
            <div class="memo-content" contenteditable="true" onblur="updateEvent('${day}', ${index}, 'memo', this.innerText)">${ev.memo}</div>
          </div>
        `;
      });
    });
    localStorage.setItem('twice_trip_v16', JSON.stringify(myEvents));
  }

  function updateEvent(day, index, field, value) {
    myEvents[day][index][field] = value.replace('â° ', '').replace('ğŸ“ ', '').replace('ğŸ  åœ°å€: ', '');
    localStorage.setItem('twice_trip_v16', JSON.stringify(myEvents));
  }

  function generateDailyRoute() {
    const addrList = myEvents[activeTab].map(e => e.addr).filter(a => a && a.trim() !== "");
    if (addrList.length < 1) return alert("æ²’åœ°å€å–”ï¼");
    let url = `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(addrList[0])}&destination=${encodeURIComponent(addrList[addrList.length-1])}&waypoints=${encodeURIComponent(addrList.slice(1,-1).join('|'))}&travelmode=transit`;
    window.open(url, '_blank');
  }

  function addNewEvent() { myEvents[activeTab].push({time: "12:00", loc: "æ–°åœ°é»", addr: "", memo: "å‚™è¨»..."}); renderEvents(); }
  function deleteEvent(day, index) { if(confirm("åˆªé™¤ï¼Ÿ")) { myEvents[day].splice(index, 1); renderEvents(); } }

  function showTab(tabId, btn) {
    activeTab = tabId;
    document.querySelectorAll('.day-content').forEach(d => d.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
    btn.classList.add('active');
    document.getElementById('add-btn-container').style.display = (tabId === 'checklist-tab') ? 'none' : 'block';
  }

  function updateCountdown() {
    const diff = new Date('2026-04-26T17:00:00+09:00') - new Date();
    if (diff <= 0) { document.getElementById('countdown').innerText = 'START! ğŸ­'; return; }
    const d = Math.floor(diff/86400000).toString().padStart(2,'0');
    const h = Math.floor((diff/3600000)%24).toString().padStart(2,'0');
    const m = Math.floor((diff/60000)%60).toString().padStart(2,'0');
    const s = Math.floor((diff/1000)%60).toString().padStart(2,'0');
    document.getElementById('countdown').innerText = `${d}D ${h}:${m}:${s}`;
  }

  setInterval(updateCountdown, 1000);
  renderAll();
</script>

</body>
</html>
