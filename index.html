<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TWICE 2026 Guide</title>

<style>
  :root { --primary: #F04E98; --bg: #fdfbfb; --card-bg: #ffffff; --text: #333; --grad: linear-gradient(135deg, #FFAD60, #F04E98); }
  body { font-family: -apple-system, sans-serif; margin:0; background: var(--bg); color: var(--text); padding-bottom: 120px; }
  header { background: var(--grad); color:white; text-align:center; padding:18px; font-weight:bold; position:sticky; top:0; z-index:1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
  .member-palette { display: flex; overflow-x: auto; padding: 15px; gap: 12px; background: #fff; border-bottom: 1px solid #eee; }
  .member-dot { width: 32px; height: 32px; border-radius: 50%; border: 2px solid #f0f0f0; flex-shrink: 0; cursor: pointer; }
  #countdown { background:#222; color:#FFAD60; font-size:1em; padding:8px; text-align:center; font-family: monospace; }
  .tabs { display: flex; background: white; position: sticky; top: 71px; z-index: 999; border-bottom: 1px solid #ddd; }
  .tab-btn { padding: 14px; border: none; background: none; font-weight: bold; color: #bbb; flex: 1; outline:none; font-size: 0.8em; }
  .tab-btn.active { color: #F04E98; border-bottom: 3px solid #F04E98; }
  .day-content { display: none; padding: 15px; }
  .day-content.active { display: block; }
  .event-card { background: var(--card-bg); border-radius: 15px; padding: 16px; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); position: relative; border-left: 10px solid var(--primary); }
  .info-box { background: #f9f9f9; padding: 10px; border-radius: 8px; font-size: 0.85em; margin-bottom: 8px; border: 1px solid #eee; }
  .big-add-btn { background: #F04E98; color: white; border: none; width: 100%; padding: 16px; border-radius: 35px; font-weight: bold; margin-top: 10px; }
  .route-planner { background: #4285F4; color: white; border: none; width: 100%; padding: 15px; border-radius: 12px; font-weight: bold; margin-bottom: 15px; }
  .color-picker-overlay { display: none; position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 20px 20px 40px; border-radius: 25px 25px 0 0; z-index: 2000; box-shadow: 0 -5px 25px rgba(0,0,0,0.2); }
  .picker-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; justify-items: center; }
  .picker-dot { width: 45px; height: 45px; border-radius: 50%; border: 2px solid #f0f0f0; }
  [contenteditable="true"]:focus { background: #fff0f5; outline: none; border-radius: 4px; padding: 0 2px; }
</style>
</head>
<body>

<header id="main-header">ğŸ­ TWICE 2026 Tokyo Guide</header>
<div class="member-palette" id="global-palette"></div>
<div id="countdown">00D 00:00:00</div>

<div class="tabs">
  <button class="tab-btn active" onclick="showTab('checklist-tab', this)">CHECK</button>
  <button class="tab-btn" onclick="showTab('day1', this)">4/25 å…­</button>
  <button class="tab-btn" onclick="showTab('day2', this)">4/26 æ—¥</button>
  <button class="tab-btn" onclick="showTab('day3', this)">4/27 ä¸€</button>
  <button class="tab-btn" onclick="showTab('trans-tab', this)">äº¤é€š</button>
</div>

<div id="checklist-tab" class="day-content active"><div id="packing-list"></div><button class="big-add-btn" onclick="addCheckItem('packing-list')">ï¼‹ æ–°å¢ç‰©å“</button></div>
<div id="day1" class="day-content"></div>
<div id="day2" class="day-content"></div>
<div id="day3" class="day-content"></div>
<div id="trans-tab" class="day-content"><div id="transport-list"></div><button class="big-add-btn" onclick="addCheckItem('transport-list')">ï¼‹ æ–°å¢äº¤é€šå‚™å¿˜</button></div>

<div class="add-area" id="add-btn-container" style="display:none; padding: 0 15px;">
  <button class="route-planner" onclick="generateDailyRoute()">ğŸ—ºï¸ è¦åŠƒä»Šæ—¥ Google Maps è·¯ç·š</button>
  <button class="big-add-btn" onclick="addNewEvent()">ï¼‹ æ‰‹å‹•æ–°å¢è¡Œç¨‹</button>
</div>

<div id="color-picker" class="color-picker-overlay">
  <div class="picker-grid" id="picker-grid"></div>
  <button onclick="closePicker()" style="width:100%; margin-top:25px; padding:15px; border-radius:15px; border:none; background:#f5f5f5;">å–æ¶ˆ</button>
</div>

<script>
  const officialColors = ["#F04E98", "#81D4FA", "#C5E1A5", "#F48FB1", "#B39DDB", "#FFB74D", "#80CBC4", "#F5F5F5", "#EF5350", "#64B5F6"];

  // 16 å€‹æ ¸å¿ƒè¡Œç¨‹åˆ†é…
  const initialTripData = {
    day1: [
      {time: "09:00", loc: "æˆç”°æ©Ÿå ´", addr: "æˆç”°æ©Ÿå ´", line: "Skyliner", station: "æˆç”°æ©Ÿå ´", memo: "å‡ºç™¼ âœˆï¸", color: "#64B5F6"},
      {time: "11:30", loc: "æ±äº¬ä¸€ç•ªè¡—", addr: "æ±äº¬ç«™ä¸€ç•ªè¡—", line: "JRå±±æ‰‹ç·š", station: "æ±äº¬ç«™", memo: "è¡Œç¨‹ 1", color: "#F04E98"},
      {time: "13:30", loc: "Tower Records æ¾€è°·", addr: "æ¾€è°·å€ç¥å—1-22-14", line: "JR/åœ°éµ", station: "æ¾€è°·ç«™", memo: "è¡Œç¨‹ 2", color: "#81D4FA"},
      {time: "15:00", loc: "SHIBUYA 109", addr: "æ¾€è°·å€é“ç„å‚2-29-1", line: "JR/åœ°éµ", station: "æ¾€è°·ç«™", memo: "è¡Œç¨‹ 3", color: "#F48FB1"},
      {time: "16:30", loc: "HMV&BOOKS æ¾€è°·", addr: "æ¾€è°·å€ç¥å—1-21-3", line: "JR/åœ°éµ", station: "æ¾€è°·ç«™", memo: "è¡Œç¨‹ 4", color: "#B39DDB"},
      {time: "18:30", loc: "ç§‹è‘‰åŸ", addr: "ç§‹è‘‰åŸ", line: "JRå±±æ‰‹ç·š", station: "ç§‹è‘‰åŸç«™", memo: "ç¬¬ä¸€å¤©çµæŸ", color: "#F5F5F5"}
    ],
    day2: [
      {time: "09:30", loc: "ç§‹è‘‰åŸ", addr: "ç§‹è‘‰åŸ", line: "JRå±±æ‰‹ç·š", station: "ç§‹è‘‰åŸç«™", memo: "è¡Œç¨‹ 5", color: "#F5F5F5"},
      {time: "11:00", loc: "åŸå®¿ç«¹ä¸‹é€š", addr: "æ¾€è°·å€ç¥å®®å‰", line: "JRå±±æ‰‹ç·š", station: "åŸå®¿ç«™", memo: "è¡Œç¨‹ 6", color: "#FFB74D"},
      {time: "13:00", loc: "æ± è¢‹ Sunshine City", addr: "è±å³¶å€æ±æ± è¢‹3-1", line: "JR/åœ°éµ", station: "æ± è¢‹ç«™", memo: "è¡Œç¨‹ 7", color: "#80CBC4"},
      {time: "14:30", loc: "K-BOOKS è¿½æ˜Ÿé¤¨", addr: "æ± è¢‹æ±å£", line: "JR/åœ°éµ", station: "æ± è¢‹ç«™", memo: "è¡Œç¨‹ 8", color: "#B39DDB"},
      {time: "17:00", loc: "åœ‹ç«‹ç«¶æŠ€å ´", addr: "åœ‹ç«‹ç«¶æŠ€å ´", line: "éƒ½ç‡Ÿå¤§æ±Ÿæˆ¶ç·š", station: "åœ‹ç«‹ç«¶æŠ€å ´ç«™", memo: "TWICE CONCERT ğŸ­", color: "#F04E98"},
      {time: "21:30", loc: "ç§‹è‘‰åŸ", addr: "ç§‹è‘‰åŸ", line: "JRå±±æ‰‹ç·š", station: "ç§‹è‘‰åŸç«™", memo: "ç¬¬äºŒå¤©çµæŸ", color: "#F5F5F5"}
    ],
    day3: [
      {time: "09:30", loc: "ç§‹è‘‰åŸ", addr: "ç§‹è‘‰åŸ", line: "JRå±±æ‰‹ç·š", station: "ç§‹è‘‰åŸç«™", memo: "è¡Œç¨‹ 9", color: "#F5F5F5"},
      {time: "11:30", loc: "æ–°å¤§ä¹…ä¿éŸ“åœ‹è¡—", addr: "æ–°å¤§ä¹…ä¿", line: "JRå±±æ‰‹ç·š", station: "æ–°å¤§ä¹…ä¿ç«™", memo: "è¡Œç¨‹ 10", color: "#EF5350"},
      {time: "14:00", loc: "æˆç”°æ©Ÿå ´", addr: "æˆç”°æ©Ÿå ´", line: "Skyliner", station: "æˆç”°æ©Ÿå ´", memo: "è¡Œç¨‹ 11 (å›åœ‹)", color: "#64B5F6"}
    ]
  };

  const initialTransData = [
    { text: "Day 1ï¼šæˆç”°æ­ Skyliner åˆ°æ—¥æš®é‡Œè½‰ JR å±±æ‰‹ç·šè‡³ç§‹è‘‰åŸã€‚å¾€æ¾€è°·æ­å±±æ‰‹ç·š 30 åˆ†é˜ã€‚" },
    { text: "Day 2ï¼šå¾€åŸå®¿æ­ä¸­å¤®ç¸½æ­¦ç·šè‡³ä»£ä»£æœ¨è½‰å±±æ‰‹ç·šã€‚å›ç§‹è‘‰åŸæ­ä¸­å¤®ç¸½æ­¦ç·šç›´é”ã€‚" },
    { text: "Day 3ï¼šæ–°å¤§ä¹…ä¿å›ç¨‹å»ºè­°è‡³æ–°å®¿æ­ N'EX æˆ–æ—¥æš®é‡Œæ­ Skylinerã€‚" }
  ];

  // æ ¸å¿ƒé‚è¼¯ï¼šå„ªå…ˆè®€å–å­˜æª”ï¼Œè‹¥ç„¡å‰‡è®€å–åˆå§‹è³‡æ–™
  let myItems = JSON.parse(localStorage.getItem('twice_items_v25')) || [{text: "è­·ç…§/é–€ç¥¨"}];
  let myTrans = JSON.parse(localStorage.getItem('twice_trans_v25')) || initialTransData;
  let myEvents = JSON.parse(localStorage.getItem('twice_trip_v25')) || initialTripData;
  let activeTab = 'checklist-tab';
  let editingCard = { day: null, index: null };

  // æ¸²æŸ“æˆå“¡è‰²å½©æŒ‰éˆ•
  const palette = document.getElementById('global-palette');
  officialColors.forEach((color, idx) => {
    const dot = document.createElement('div');
    dot.className = 'member-dot'; dot.style.backgroundColor = color;
    dot.onclick = () => { if(idx === 0) resetTheme(); else setGlobalTheme(color); };
    palette.appendChild(dot);
  });

  function setGlobalTheme(color) { document.documentElement.style.setProperty('--primary', color); document.getElementById('main-header').style.background = color; }
  function resetTheme() { document.documentElement.style.setProperty('--primary', '#F04E98'); document.getElementById('main-header').style.background = 'linear-gradient(135deg, #FFAD60, #F04E98)'; }

  // æ¸²æŸ“è¡Œç¨‹ (å…¨éƒ¨æ¬„ä½ contenteditable)
  function renderEvents() {
    ['day1', 'day2', 'day3'].forEach(day => {
      const container = document.getElementById(day); container.innerHTML = "";
      myEvents[day].forEach((ev, index) => {
        container.innerHTML += `<div class="event-card" style="border-left-color: ${ev.color}">
          <button style="position:absolute;right:10px;top:45px;border:none;background:none;font-size:1.2em;" onclick="openPicker('${day}', ${index})">ğŸ¨</button>
          <button style="position:absolute;right:10px;top:10px;border:none;background:none;color:#ddd;" onclick="deleteEvent('${day}', ${index})">Ã—</button>
          <span style="font-size:0.9em;font-weight:bold;color:var(--primary)" contenteditable="true" onblur="updateEvent('${day}',${index},'time',this.innerText)">â° ${ev.time}</span>
          <span style="font-size:1.1em;font-weight:bold;display:block;margin:5px 0" contenteditable="true" onblur="updateEvent('${day}',${index},'loc',this.innerText)">ğŸ“ ${ev.loc}</span>
          <div class="info-box">
            <div style="font-size:0.9em">ğŸš‡ 
                <span contenteditable="true" onblur="updateEvent('${day}',${index},'line',this.innerText)">${ev.line}</span> / 
                <span contenteditable="true" onblur="updateEvent('${day}',${index},'station',this.innerText)">${ev.station}</span>
            </div>
            <div style="font-size:0.9em; margin-top:5px;">ğŸ  
                <span contenteditable="true" onblur="updateEvent('${day}',${index},'addr',this.innerText)">${ev.addr}</span>
            </div>
          </div>
          <div style="font-size:0.85em; color:#777" contenteditable="true" onblur="updateEvent('${day}',${index},'memo',this.innerText)">${ev.memo}</div>
        </div>`;
      });
    });
    save();
  }

  // æ¸²æŸ“æ¸…å–® (è£å‚™èˆ‡äº¤é€š)
  function renderList(listId, dataArr) {
    const list = document.getElementById(listId); list.innerHTML = "";
    dataArr.forEach((item, i) => {
      list.innerHTML += `<div class="event-card" style="padding:12px; margin-bottom:10px; border-left-width:6px; display:flex; align-items:center;">
        <span style="flex:1" contenteditable="true" onblur="updateListData('${listId}', ${i}, this.innerText)">${item.text}</span>
        <button style="border:none;background:none;color:#ccc;" onclick="deleteListItem('${listId}', ${i})">Ã—</button>
      </div>`;
    });
    save();
  }

  function updateEvent(d, i, f, v) { myEvents[d][i][f] = v.replace('â° ', '').replace('ğŸ“ ', '').replace('ğŸ  ', '').replace('ğŸš‡ ', ''); save(); }
  function updateListData(listId, i, v) { if(listId === 'packing-list') myItems[i].text = v; else myTrans[i].text = v; save(); }
  function deleteListItem(listId, i) { if(confirm("åˆªé™¤ï¼Ÿ")) { if(listId === 'packing-list') myItems.splice(i,1); else myTrans.splice(i,1); refreshAll(); } }
  function deleteEvent(d, i) { if(confirm("åˆªé™¤è¡Œç¨‹ï¼Ÿ")) { myEvents[d].splice(i, 1); renderEvents(); } }
  function addCheckItem(listId) { if(listId === 'packing-list') myItems.push({text: "æ–°é …ç›®"}); else myTrans.push({text: "æ–°äº¤é€šå‚™å¿˜"}); refreshAll(); }
  function addNewEvent() { myEvents[activeTab].push({time: "12:00", loc: "æ–°åœ°é»", addr: "åœ°å€", line:"ç·šè·¯", station:"è»Šç«™", memo: "å‚™è¨»", color: "#F04E98"}); renderEvents(); }
  function save() { localStorage.setItem('twice_items_v25', JSON.stringify(myItems)); localStorage.setItem('twice_trans_v25', JSON.stringify(myTrans)); localStorage.setItem('twice_trip_v25', JSON.stringify(myEvents)); }
  function refreshAll() { renderEvents(); renderList('packing-list', myItems); renderList('transport-list', myTrans); }

  function showTab(t, b) { 
    activeTab = t; 
    document.querySelectorAll('.day-content').forEach(d => d.classList.remove('active')); 
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active')); 
    document.getElementById(t).classList.add('active'); b.classList.add('active'); 
    document.getElementById('add-btn-container').style.display = (t.includes('tab')) ? 'none' : 'block'; 
  }

  function openPicker(d, i) { editingCard = { day: d, index: i }; document.getElementById('picker-grid').innerHTML = officialColors.map(c => `<div class="picker-dot" style="background:${c}" onclick="setCardColor('${c}')"></div>`).join(''); document.getElementById('color-picker').style.display = 'block'; }
  function closePicker() { document.getElementById('color-picker').style.display = 'none'; }
  function setCardColor(c) { myEvents[editingCard.day][editingCard.index].color = c; renderEvents(); closePicker(); }
  function generateDailyRoute() {
    const addrs = myEvents[activeTab].map(e => e.addr.trim()).filter(a => a !== "" && a !== "åœ°å€");
    if (addrs.length < 2) return alert("è«‹å¡«å¯«åœ°å€");
    window.location.href = `https://www.google.com/maps/dir/${addrs.map(encodeURIComponent).join('/')}`;
  }

  setInterval(() => {
    const diff = new Date('2026-04-26T17:00:00+09:00') - new Date();
    document.getElementById('countdown').innerText = diff > 0 ? (Math.floor(diff/86400000).toString().padStart(2,'0') + "D " + Math.floor((diff/3600000)%24).toString().padStart(2,'0') + ":" + Math.floor((diff/60000)%60).toString().padStart(2,'0') + ":" + Math.floor((diff/1000)%60).toString().padStart(2,'0')) : 'SHOW TIME! ğŸ­';
  }, 1000);

  refreshAll();
</script>
</body>
</html>
