<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TWICE 2026 Guide</title>

<link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
<link rel="icon" type="image/png" href="icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
  :root { --primary: #F04E98; --bg: #fdfbfb; --card-bg: #ffffff; --text: #333; }
  body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin:0; background: var(--bg); color: var(--text); padding-bottom: 120px; -webkit-tap-highlight-color: transparent; }
  header { background: linear-gradient(135deg, #FFAD60, #F04E98); color:white; text-align:center; padding:18px; font-weight:bold; position:sticky; top:0; z-index:1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
  
  .member-palette { display: flex; overflow-x: auto; padding: 12px; gap: 10px; background: #fff; border-bottom: 1px solid #eee; }
  .member-dot-wrap { display: flex; flex-direction: column; align-items: center; min-width: 45px; cursor: pointer; }
  .member-dot { width: 35px; height: 35px; border-radius: 50%; border: 2px solid #f0f0f0; margin-bottom: 4px; }
  .member-label { font-size: 10px; color: #666; }

  #countdown { background:#222; color:#FFAD60; font-size:1em; padding:8px; text-align:center; font-family: monospace; letter-spacing: 1px; }
  .tabs { display: flex; background: white; position: sticky; top: 71px; z-index: 999; border-bottom: 1px solid #ddd; }
  .tab-btn { padding: 14px; border: none; background: none; font-weight: bold; color: #bbb; flex: 1; outline: none; }
  .tab-btn.active { color: #F04E98; border-bottom: 3px solid #F04E98; }

  .day-content { display: none; padding: 15px; }
  .day-content.active { display: block; }

  .event-card { 
    background: var(--card-bg); border-radius: 15px; padding: 16px; margin-bottom: 15px; 
    box-shadow: 0 4px 12px rgba(0,0,0,0.05); position: relative; border-left: 10px solid var(--primary);
  }

  .address-box { background: #f9f9f9; padding: 10px; border-radius: 8px; font-size: 0.85em; margin-bottom: 10px; border: 1px solid #eee; color: #666; }
  .route-planner { background: #4285F4; color: white; border: none; width: 100%; padding: 15px; border-radius: 12px; font-weight: bold; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(66,133,244,0.3); }
  .big-add-btn { background: #F04E98; color: white; border: none; width: 100%; padding: 16px; border-radius: 35px; font-weight: bold; margin-top: 10px; }

  /* é¡è‰²é¸æ“‡å™¨ */
  .color-picker-overlay {
    display: none; position: fixed; bottom: 0; left: 0; right: 0; background: white; 
    padding: 20px 20px 40px; border-radius: 25px 25px 0 0; z-index: 2000; box-shadow: 0 -5px 25px rgba(0,0,0,0.2);
  }
  .picker-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; text-align: center; font-size: 0.75em; }
  .picker-dot { width: 50px; height: 50px; border-radius: 50%; margin: 0 auto 5px; border: 2px solid #f0f0f0; }
</style>
</head>
<body>

<header id="main-header">ğŸ­ TWICE 2026 Tokyo Guide</header>
<div class="member-palette" id="global-palette"></div>
<div id="countdown">00D 00:00:00</div>

<div class="tabs">
  <button class="tab-btn active" onclick="showTab('checklist-tab', this)">ğŸ§³ è£å‚™</button>
  <button class="tab-btn" onclick="showTab('day1', this)">4/25</button>
  <button class="tab-btn" onclick="showTab('day2', this)">4/26</button>
  <button class="tab-btn" onclick="showTab('day3', this)">4/27</button>
</div>

<div id="checklist-tab" class="day-content active">
  <div id="packing-list"></div>
  <button class="big-add-btn" onclick="addCheckItem()">ï¼‹ æ–°å¢å‚™å¿˜ç‰©å“</button>
</div>

<div id="day1" class="day-content"></div>
<div id="day2" class="day-content"></div>
<div id="day3" class="day-content"></div>

<div class="add-area" id="add-btn-container" style="display:none; padding: 0 15px;">
  <button class="route-planner" onclick="generateDailyRoute()">ğŸ—ºï¸ è¦åŠƒé †æš¢è·¯ç·š (Google Maps)</button>
  <button class="big-add-btn" onclick="addNewEvent()">ï¼‹ æ–°å¢è¡Œç¨‹åœ°é»</button>
</div>

<div id="color-picker" class="color-picker-overlay">
  <h3 style="margin:0 0 20px; text-align:center;">é¸æ“‡ä»£è¡¨è‰²</h3>
  <div class="picker-grid" id="picker-grid"></div>
  <button onclick="closePicker()" style="width:100%; margin-top:25px; padding:15px; border-radius:15px; border:none; background:#f5f5f5; font-weight:bold;">å–æ¶ˆ</button>
</div>

<script>
  const memberColors = [
    { name: "TWICE", color: "#F04E98" }, { name: "å¨œç’‰", color: "#81D4FA" },
    { name: "å®šå»¶", color: "#C5E1A5" }, { name: "Momo", color: "#F48FB1" },
    { name: "Sana", color: "#B39DDB" }, { name: "å¿—æ•ˆ", color: "#FFB74D" },
    { name: "Mina", color: "#80CBC4" }, { name: "å¤šè³¢", color: "#F5F5F5" },
    { name: "å½©ç‘›", color: "#EF5350" }, { name: "å­ç‘œ", color: "#64B5F6" }
  ];

  const initialTripData = {
    day1: [
      {time: "10:00", loc: "K-spot (æ±äº¬ä¸€ç•ªè¡—)", addr: "æ±äº¬éƒ½åƒä»£ç”°å€ä¸¸ä¹‹å…§1-9-1", memo: "å®˜æ–¹è¯åå¿«é–ƒåº—", color: "#F04E98"},
      {time: "13:30", loc: "K-BOOKS K-POPé¤¨", addr: "æ±äº¬éƒ½è±å³¶å€æ±æ± è¢‹1-28-1", memo: "æ± è¢‹å°‹å¯¶å°å¡", color: "#F48FB1"},
      {time: "16:00", loc: "Tower Records æ± è¢‹", addr: "æ±äº¬éƒ½è±å³¶å€æ±æ± è¢‹1-50-35", memo: "æ‡‰æ´çœ‹æ¿å·¡ç¦®", color: "#B39DDB"}
    ],
    day2: [
      {time: "11:00", loc: "Tower Records æ¾€è°·", addr: "æ±äº¬éƒ½æ¾€è°·å€ç¥å—1-22-14", memo: "1F å¤§çœ‹æ¿æ‹ç…§", color: "#81D4FA"},
      {time: "17:00", loc: "ğŸŸï¸ åœ‹ç«‹ç«¶æŠ€å ´", addr: "æ±äº¬éƒ½æ–°å®¿å€éœä¸˜ç”º10-1", memo: "TWICE CONCERT!", color: "#F04E98"}
    ],
    day3: [
      {time: "10:30", loc: "Seoul Record", addr: "æ±äº¬éƒ½æ–°å®¿å€å¤§ä¹…ä¿1-16-13", memo: "æ–°å¤§ä¹…ä¿è€å­—è™Ÿå”±ç‰‡è¡Œ", color: "#C5E1A5"},
      {time: "13:00", loc: "Tower Records æ–°å®¿", addr: "æ±äº¬éƒ½æ–°å®¿å€æ–°å®¿3-37-1", memo: "Flags ç°½åç‰†", color: "#64B5F6"}
    ]
  };

  let myItems = JSON.parse(localStorage.getItem('twice_items_v18_3')) || [{text: "è­·ç…§ & é–€ç¥¨", checked: false}];
  let myEvents = JSON.parse(localStorage.getItem('twice_trip_v18_3')) || initialTripData;
  let activeTab = 'checklist-tab';
  let editingCard = { day: null, index: null };

  const palette = document.getElementById('global-palette');
  memberColors.forEach(m => {
    palette.innerHTML += `<div class="member-dot-wrap" onclick="setGlobalTheme('${m.color}')"><div class="member-dot" style="background:${m.color}"></div><div class="member-label">${m.name}</div></div>`;
  });

  function setGlobalTheme(color) {
    document.documentElement.style.setProperty('--primary', color);
    document.getElementById('main-header').style.background = color;
  }

  function generateDailyRoute() {
    const addresses = myEvents[activeTab]
      .map(e => e.addr.trim())
      .filter(a => a !== "" && a !== "é»æ“Šç·¨è¼¯åœ°å€");

    if (addresses.length < 2) {
      alert("è«‹è‡³å°‘å¡«å¯«å…©å€‹åœ°é»çš„åœ°å€ï¼Œæ‰èƒ½è¦åŠƒè·¯ç·šå”·ï¼");
      return;
    }

    // ä½¿ç”¨å®˜æ–¹æ¨è–¦çš„ Universal Link æ ¼å¼ï¼Œæ¸›å°‘å¡é “ä¸¦è‡ªå‹•å–šèµ· App
    const origin = encodeURIComponent(addresses[0]);
    const destination = encodeURIComponent(addresses[addresses.length - 1]);
    let waypoints = "";
    
    if (addresses.length > 2) {
      waypoints = encodeURIComponent(addresses.slice(1, -1).join('|'));
    }

    const mapUrl = `https://www.google.com/maps/dir/?api=1&origin=${origin}&destination=${destination}${waypoints ? '&waypoints=' + waypoints : ''}&travelmode=transit`;
    
    window.location.href = mapUrl; // ä½¿ç”¨ location.href åœ¨ PWA ä¸­é€šå¸¸æ¯” window.open æ›´é †æš¢
  }

  function renderEvents() {
    ['day1', 'day2', 'day3'].forEach(day => {
      const container = document.getElementById(day); container.innerHTML = "";
      myEvents[day].forEach((ev, index) => {
        container.innerHTML += `
          <div class="event-card" style="border-left-color: ${ev.color}">
            <button style="position:absolute;right:10px;top:45px;border:none;background:none;font-size:1.5em;" onclick="openPicker('${day}', ${index})">ğŸ¨</button>
            <button style="position:absolute;right:10px;top:10px;border:none;background:none;color:#ddd;font-size:1.2em;" onclick="deleteEvent('${day}', ${index})">Ã—</button>
            <span style="font-size:0.9em;font-weight:bold;color:var(--primary)" contenteditable="true" onblur="updateEvent('${day}',${index},'time',this.innerText)">â° ${ev.time}</span>
            <span style="font-size:1.1em;font-weight:bold;display:block;margin:5px 0" contenteditable="true" onblur="updateEvent('${day}',${index},'loc',this.innerText)">ğŸ“ ${ev.loc}</span>
            <div class="address-box">ğŸ  <span contenteditable="true" onblur="updateEvent('${day}',${index},'addr',this.innerText)">${ev.addr || 'é»æ“Šç·¨è¼¯åœ°å€'}</span></div>
            <div style="font-size:0.85em; color:#777" contenteditable="true" onblur="updateEvent('${day}',${index},'memo',this.innerText)">${ev.memo}</div>
          </div>`;
    });
    localStorage.setItem('twice_trip_v18_3', JSON.stringify(myEvents));
    });
  }

  function renderItems() {
    const list = document.getElementById('packing-list'); list.innerHTML = "";
    myItems.forEach((item, i) => {
      list.innerHTML += `<div class="event-card" style="padding:12px; margin-bottom:10px; border-left-width:6px; display:flex; align-items:center;">
        <input type="checkbox" style="width:22px; height:22px; margin-right:12px;" ${item.checked ? 'checked' : ''} onchange="toggleItem(${i})">
        <span style="flex:1" contenteditable="true" onblur="updateItemText(${i}, this.innerText)">${item.text}</span>
        <button style="border:none;background:none;color:#ccc;font-size:1.2em;" onclick="deleteItem(${i})">Ã—</button>
      </div>`;
    });
    localStorage.setItem('twice_items_v18_3', JSON.stringify(myItems));
  }

  // å…¶ä»–é‚è¼¯ç¶­æŒ
  function openPicker(d, i) { 
    editingCard = { day: d, index: i }; 
    const grid = document.getElementById('picker-grid');
    grid.innerHTML = memberColors.map(m => `<div onclick="setCardColor('${m.color}')"><div class="picker-dot" style="background:${m.color}"></div><b>${m.name}</b></div>`).join('');
    document.getElementById('color-picker').style.display = 'block'; 
  }
  function closePicker() { document.getElementById('color-picker').style.display = 'none'; }
  function setCardColor(c) { myEvents[editingCard.day][editingCard.index].color = c; renderEvents(); closePicker(); }
  function updateItemText(i, v) { myItems[i].text = v; localStorage.setItem('twice_items_v18_3', JSON.stringify(myItems)); }
  function toggleItem(i) { myItems[i].checked = !myItems[i].checked; localStorage.setItem('twice_items_v18_3', JSON.stringify(myItems)); }
  function addCheckItem() { myItems.push({text: "æ–°ç‰©å“", checked: false}); renderItems(); }
  function updateEvent(d, i, f, v) { myEvents[d][i][f] = v.replace('â° ', '').replace('ğŸ“ ', '').replace('ğŸ  ', ''); localStorage.setItem('twice_trip_v18_3', JSON.stringify(myEvents)); }
  function deleteEvent(d, i) { if(confirm("åˆªé™¤è¡Œç¨‹ï¼Ÿ")) { myEvents[d].splice(i, 1); renderEvents(); } }
  function addNewEvent() { myEvents[activeTab].push({time: "12:00", loc: "æ–°åœ°é»", addr: "", memo: "é»æ“Šç·¨è¼¯", color: "#F04E98"}); renderEvents(); }
  function showTab(t, b) { activeTab = t; document.querySelectorAll('.day-content').forEach(d => d.classList.remove('active')); document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active')); document.getElementById(t).classList.add('active'); b.classList.add('active'); document.getElementById('add-btn-container').style.display = (t === 'checklist-tab') ? 'none' : 'block'; }
  function updateCountdown() { const diff = new Date('2026-04-26T17:00:00+09:00') - new Date(); if (diff <= 0) { document.getElementById('countdown').innerText = 'CONCERT TIME! ğŸ­'; return; } const d = Math.floor(diff/86400000).toString().padStart(2,'0'); const h = Math.floor((diff/3600000)%24).toString().padStart(2,'0'); const m = Math.floor((diff/60000)%60).toString().padStart(2,'0'); const s = Math.floor((diff/1000)%60).toString().padStart(2,'0'); document.getElementById('countdown').innerText = `${d}D ${h}:${m}:${s}`; }
  setInterval(updateCountdown, 1000); renderItems(); renderEvents();
</script>
</body>
</html>
